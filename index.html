<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#6366f1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <title>Dizi Takip</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
        }
        #root {
            width: 100%;
            min-height: 100vh;
        }
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // âš ï¸ BURAYA FIREBASE CONFIG BÄ°LGÄ°LERÄ°NÄ°ZÄ° YAPIÅžTIRIN
        const firebaseConfig = {
          apiKey: "BURAYA_API_KEY",
          authDomain: "BURAYA_AUTH_DOMAIN",
          projectId: "BURAYA_PROJECT_ID",
          storageBucket: "BURAYA_STORAGE_BUCKET",
          messagingSenderId: "BURAYA_MESSAGING_SENDER_ID",
          appId: "BURAYA_APP_ID"
        };

        // Firebase'i baÅŸlat
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const db = firebase.firestore();

        // Benzersiz cihaz ID'si oluÅŸtur (her cihaz iÃ§in farklÄ±)
        let deviceId = localStorage.getItem('deviceId');
        if (!deviceId) {
            deviceId = 'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            localStorage.setItem('deviceId', deviceId);
        }

        // Lucide Icons Components
        const Plus = ({size = 24, ...props}) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
        );

        const Trash2 = ({size = 24, ...props}) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>
                <polyline points="3 6 5 6 21 6"></polyline>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                <line x1="10" y1="11" x2="10" y2="17"></line>
                <line x1="14" y1="11" x2="14" y2="17"></line>
            </svg>
        );

        const Check = ({size = 24, ...props}) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>
                <polyline points="20 6 9 17 4 12"></polyline>
            </svg>
        );

        const Calendar = ({size = 24, ...props}) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                <line x1="16" y1="2" x2="16" y2="6"></line>
                <line x1="8" y1="2" x2="8" y2="6"></line>
                <line x1="3" y1="10" x2="21" y2="10"></line>
            </svg>
        );

        const BarChart3 = ({size = 24, ...props}) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>
                <path d="M3 3v18h18"></path>
                <path d="M18 17V9"></path>
                <path d="M13 17V5"></path>
                <path d="M8 17v-3"></path>
            </svg>
        );

        const Tv = ({size = 24, ...props}) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>
                <rect x="2" y="7" width="20" height="15" rx="2" ry="2"></rect>
                <polyline points="17 2 12 7 7 2"></polyline>
            </svg>
        );

        const Clock = ({size = 24, ...props}) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>
                <circle cx="12" cy="12" r="10"></circle>
                <polyline points="12 6 12 12 16 14"></polyline>
            </svg>
        );

        const Edit2 = ({size = 24, ...props}) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>
                <path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"></path>
            </svg>
        );

        const ChevronDown = ({size = 24, ...props}) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>
                <polyline points="6 9 12 15 18 9"></polyline>
            </svg>
        );

        const ChevronUp = ({size = 24, ...props}) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>
                <polyline points="18 15 12 9 6 15"></polyline>
            </svg>
        );

        const DAYS = ['Pazartesi', 'SalÄ±', 'Ã‡arÅŸamba', 'PerÅŸembe', 'Cuma', 'Cumartesi', 'Pazar'];

        function TVSeriesTracker() {
          const [series, setSeries] = useState([]);
          const [watchedEpisodes, setWatchedEpisodes] = useState([]);
          const [activeTab, setActiveTab] = useState('program');
          const [showAddForm, setShowAddForm] = useState(false);
          const [editingSeries, setEditingSeries] = useState(null);
          const [expandedSeries, setExpandedSeries] = useState({});
          const [loading, setLoading] = useState(true);
          const [newSeries, setNewSeries] = useState({
            name: '',
            day: 'Pazartesi',
            time: '20:00',
            channel: '',
            seasons: [{ number: 1, totalEpisodes: 10 }]
          });

          useEffect(() => {
            let unsubscribeSeries = null;
            let unsubscribeWatched = null;
            
            const setupListeners = async () => {
              try {
                setLoading(true);
                console.log('Cihaz ID:', deviceId);
                console.log('Firebase baÄŸlantÄ±sÄ± kuruluyor...');
                
                // Ä°lk veri yÃ¼kleme
                const seriesSnapshot = await db.collection('users').doc(deviceId).collection('series').get();
                const seriesData = [];
                seriesSnapshot.forEach((doc) => {
                  seriesData.push({ ...doc.data(), id: doc.id });
                });
                setSeries(seriesData);
                console.log('Ä°lk diziler yÃ¼klendi:', seriesData.length, seriesData);

                const watchedSnapshot = await db.collection('users').doc(deviceId).collection('watched').get();
                const watchedData = [];
                watchedSnapshot.forEach((doc) => {
                  watchedData.push({ ...doc.data(), key: doc.id });
                });
                setWatchedEpisodes(watchedData);
                console.log('Ä°lk izlenenler yÃ¼klendi:', watchedData.length);
                
                setLoading(false);
                
                // GerÃ§ek zamanlÄ± dinleyicileri baÅŸlat
                unsubscribeSeries = db.collection('users').doc(deviceId).collection('series')
                  .onSnapshot((snapshot) => {
                    const seriesData = [];
                    snapshot.forEach((doc) => {
                      seriesData.push({ ...doc.data(), id: doc.id });
                    });
                    console.log('Diziler real-time gÃ¼ncellendi:', seriesData.length, seriesData);
                    setSeries(seriesData);
                  }, (error) => {
                    console.error('Dizi dinleme hatasÄ±:', error);
                  });

                unsubscribeWatched = db.collection('users').doc(deviceId).collection('watched')
                  .onSnapshot((snapshot) => {
                    const watchedData = [];
                    snapshot.forEach((doc) => {
                      watchedData.push({ ...doc.data(), key: doc.id });
                    });
                    console.log('Ä°zlenenler real-time gÃ¼ncellendi:', watchedData.length);
                    setWatchedEpisodes(watchedData);
                  }, (error) => {
                    console.error('Ä°zlenen dinleme hatasÄ±:', error);
                  });
                  
              } catch (error) {
                console.error('Firebase kurulum hatasÄ±:', error);
                alert('Firebase baÄŸlantÄ± hatasÄ±: ' + error.message);
                setLoading(false);
              }
            };
            
            setupListeners();

            return () => {
              if (unsubscribeSeries) unsubscribeSeries();
              if (unsubscribeWatched) unsubscribeWatched();
            };
          }, []);

          const addSeries = async () => {
            if (!newSeries.name.trim()) {
              alert('LÃ¼tfen dizi adÄ± girin!');
              return;
            }
            
            try {
              console.log('Dizi ekleniyor...', newSeries);
              
              // Ã–nce formu kapat
              setShowAddForm(false);
              
              const seriesData = {
                name: newSeries.name,
                day: newSeries.day,
                time: newSeries.time,
                channel: newSeries.channel,
                seasons: newSeries.seasons,
                addedDate: new Date().toISOString()
              };
              
              const docRef = await db.collection('users').doc(deviceId).collection('series').add(seriesData);
              console.log('Dizi eklendi! ID:', docRef.id);
              
              // Formu sÄ±fÄ±rla
              setNewSeries({
                name: '',
                day: 'Pazartesi',
                time: '20:00',
                channel: '',
                seasons: [{ number: 1, totalEpisodes: 10 }]
              });
              
            } catch (error) {
              console.error('Dizi eklenirken hata:', error);
              alert('Dizi eklenirken hata oluÅŸtu: ' + error.message);
              // Hata durumunda formu tekrar aÃ§
              setShowAddForm(true);
            }
          };

          const updateSeries = async () => {
            if (!editingSeries.name.trim()) return;
            
            try {
              const { id, ...seriesData } = editingSeries;
              await db.collection('users').doc(deviceId).collection('series').doc(id).update(seriesData);
              setEditingSeries(null);
            } catch (error) {
              console.error('Dizi gÃ¼ncellenirken hata:', error);
              alert('Dizi gÃ¼ncellenirken hata oluÅŸtu!');
            }
          };

          const deleteSeries = async (id) => {
            if (!confirm('Bu diziyi silmek istediÄŸinize emin misiniz?')) return;
            
            try {
              // Diziyi sil
              await db.collection('users').doc(deviceId).collection('series').doc(id).delete();
              
              // O diziye ait izlenen bÃ¶lÃ¼mleri sil
              const watchedSnapshot = await db.collection('users').doc(deviceId).collection('watched')
                .where('seriesId', '==', id).get();
              
              const batch = db.batch();
              watchedSnapshot.forEach((doc) => {
                batch.delete(doc.ref);
              });
              await batch.commit();
            } catch (error) {
              console.error('Dizi silinirken hata:', error);
              alert('Dizi silinirken hata oluÅŸtu!');
            }
          };

          const addSeason = (seriesObj, isEditing = false) => {
            const seasons = seriesObj.seasons || [];
            const lastSeasonNum = seasons.length > 0 
              ? Math.max(...seasons.map(s => s.number))
              : 0;
            
            const newSeason = { number: lastSeasonNum + 1, totalEpisodes: 10 };
            
            if (isEditing) {
              setEditingSeries({
                ...seriesObj,
                seasons: [...seasons, newSeason]
              });
            } else {
              setNewSeries({
                ...seriesObj,
                seasons: [...seasons, newSeason]
              });
            }
          };

          const removeSeason = async (seriesObj, seasonIndex, isEditing = false) => {
            const seasons = seriesObj.seasons || [];
            if (seasons.length <= 1) {
              alert('En az bir sezon olmalÄ±dÄ±r!');
              return;
            }
            
            const updatedSeasons = seasons.filter((_, i) => i !== seasonIndex);
            
            if (isEditing) {
              setEditingSeries({
                ...seriesObj,
                seasons: updatedSeasons
              });
              
              // O sezona ait izlenen bÃ¶lÃ¼mleri sil
              try {
                const removedSeason = seasons[seasonIndex];
                const watchedSnapshot = await db.collection('users').doc(deviceId).collection('watched')
                  .where('seriesId', '==', seriesObj.id)
                  .where('season', '==', removedSeason.number).get();
                
                const batch = db.batch();
                watchedSnapshot.forEach((doc) => {
                  batch.delete(doc.ref);
                });
                await batch.commit();
              } catch (error) {
                console.error('Sezon silinirken hata:', error);
              }
            } else {
              setNewSeries({
                ...seriesObj,
                seasons: updatedSeasons
              });
            }
          };

          const updateSeasonEpisodes = (seriesObj, seasonIndex, totalEpisodes, isEditing = false) => {
            const seasons = seriesObj.seasons || [];
            const updatedSeasons = [...seasons];
            updatedSeasons[seasonIndex] = { 
              ...updatedSeasons[seasonIndex], 
              totalEpisodes: parseInt(totalEpisodes) || 1 
            };
            
            if (isEditing) {
              setEditingSeries({
                ...seriesObj,
                seasons: updatedSeasons
              });
            } else {
              setNewSeries({
                ...seriesObj,
                seasons: updatedSeasons
              });
            }
          };

          const toggleWatched = async (seriesId, season, episode) => {
            const key = `${seriesId}-${season}-${episode}`;
            const existing = watchedEpisodes.find(w => w.key === key);
            
            try {
              if (existing) {
                // Sil
                await db.collection('users').doc(deviceId).collection('watched').doc(key).delete();
              } else {
                // Ekle
                await db.collection('users').doc(deviceId).collection('watched').doc(key).set({
                  seriesId,
                  season,
                  episode,
                  watchedDate: new Date().toISOString()
                });
              }
            } catch (error) {
              console.error('BÃ¶lÃ¼m iÅŸaretlenirken hata:', error);
            }
          };

          const isWatched = (seriesId, season, episode) => {
            const key = `${seriesId}-${season}-${episode}`;
            return watchedEpisodes.some(w => w.key === key);
          };

          const toggleExpanded = (seriesId) => {
            setExpandedSeries(prev => ({
              ...prev,
              [seriesId]: !prev[seriesId]
            }));
          };

          const getCurrentEpisode = (s) => {
            const watchedForSeries = watchedEpisodes.filter(w => w.seriesId === s.id);
            if (watchedForSeries.length === 0) return { season: 1, episode: 1 };
            
            const latest = watchedForSeries.reduce((max, w) => {
              if (w.season > max.season || (w.season === max.season && w.episode > max.episode)) {
                return w;
              }
              return max;
            }, { season: 1, episode: 0 });
            
            return { season: latest.season, episode: latest.episode + 1 };
          };

          const getWeeklyStats = () => {
            const today = new Date();
            const weekAgo = new Date(today.getTime() - 7 * 24 * 60 * 60 * 1000);
            
            const weeklyWatched = watchedEpisodes.filter(w => {
              const watchedDate = new Date(w.watchedDate);
              return watchedDate >= weekAgo && watchedDate <= today;
            });

            return {
              total: weeklyWatched.length,
              bySeries: series.map(s => ({
                name: s.name,
                count: weeklyWatched.filter(w => w.seriesId === s.id).length
              })).filter(s => s.count > 0)
            };
          };

          const getMonthlyStats = () => {
            const today = new Date();
            const monthAgo = new Date(today.getTime() - 30 * 24 * 60 * 60 * 1000);
            
            const monthlyWatched = watchedEpisodes.filter(w => {
              const watchedDate = new Date(w.watchedDate);
              return watchedDate >= monthAgo && watchedDate <= today;
            });

            return {
              total: monthlyWatched.length,
              bySeries: series.map(s => ({
                name: s.name,
                count: monthlyWatched.filter(w => w.seriesId === s.id).length
              })).filter(s => s.count > 0)
            };
          };

          const renderProgram = () => {
            return (
              <div className="space-y-4">
                {DAYS.map(day => {
                  const daySeries = series.filter(s => s.day === day).sort((a, b) => a.time.localeCompare(b.time));
                  
                  return (
                    <div key={day} className="bg-white rounded-lg shadow-sm p-4">
                      <h3 className="font-bold text-lg mb-3 text-indigo-700">{day}</h3>
                      {daySeries.length === 0 ? (
                        <p className="text-gray-400 text-sm">Bu gÃ¼n iÃ§in dizi yok</p>
                      ) : (
                        <div className="space-y-2">
                          {daySeries.map(s => {
                            const current = getCurrentEpisode(s);
                            return (
                              <div key={s.id} className="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                <div className="flex-1">
                                  <div className="font-semibold text-gray-800">{s.name}</div>
                                  <div className="text-sm text-gray-600 flex items-center gap-3 mt-1">
                                    <span className="flex items-center gap-1">
                                      <Clock size={14} />
                                      {s.time}
                                    </span>
                                    {s.channel && <span>{s.channel}</span>}
                                    <span>S{current.season}E{current.episode}</span>
                                  </div>
                                </div>
                                <button
                                  onClick={() => toggleWatched(s.id, current.season, current.episode)}
                                  className={`p-2 rounded-full transition-colors ${
                                    isWatched(s.id, current.season, current.episode)
                                      ? 'bg-green-500 text-white'
                                      : 'bg-gray-200 text-gray-500'
                                  }`}
                                >
                                  <Check size={18} />
                                </button>
                              </div>
                            );
                          })}
                        </div>
                      )}
                    </div>
                  );
                })}
              </div>
            );
          };

          const renderSeries = () => {
            return (
              <div className="space-y-3">
                {series.length === 0 ? (
                  <div className="text-center py-12 text-gray-400">
                    <Tv size={48} className="mx-auto mb-3 opacity-50" />
                    <p>HenÃ¼z dizi eklemediniz</p>
                  </div>
                ) : (
                  series.map(s => (
                    <div key={s.id} className="bg-white rounded-lg shadow-sm p-4">
                      <div className="flex items-start justify-between mb-3">
                        <div className="flex-1">
                          <h3 className="font-bold text-lg text-gray-800">{s.name}</h3>
                          <p className="text-sm text-gray-600">{s.day} - {s.time}</p>
                          {s.channel && <p className="text-sm text-gray-500">{s.channel}</p>}
                        </div>
                        <div className="flex gap-2">
                          <button
                            onClick={() => setEditingSeries({...s})}
                            className="p-2 text-blue-500 hover:bg-blue-50 rounded-lg transition-colors"
                          >
                            <Edit2 size={18} />
                          </button>
                          <button
                            onClick={() => deleteSeries(s.id)}
                            className="p-2 text-red-500 hover:bg-red-50 rounded-lg transition-colors"
                          >
                            <Trash2 size={18} />
                          </button>
                        </div>
                      </div>
                      
                      <button
                        onClick={() => toggleExpanded(s.id)}
                        className="w-full flex items-center justify-between py-2 px-3 bg-gray-100 rounded-lg mb-3 hover:bg-gray-200 transition-colors"
                      >
                        <span className="font-medium text-gray-700">
                          {(s.seasons || []).length} Sezon
                        </span>
                        {expandedSeries[s.id] ? <ChevronUp size={20} /> : <ChevronDown size={20} />}
                      </button>

                      {expandedSeries[s.id] && (
                        <div className="space-y-4">
                          {(s.seasons || []).map((season, idx) => {
                            const watchedCount = watchedEpisodes.filter(w => 
                              w.seriesId === s.id && w.season === season.number
                            ).length;
                            
                            return (
                              <div key={idx} className="border-l-4 border-indigo-500 pl-3">
                                <div className="font-semibold text-gray-700 mb-2">
                                  Sezon {season.number} ({watchedCount}/{season.totalEpisodes} izlendi)
                                </div>
                                <div className="grid grid-cols-5 gap-2">
                                  {[...Array(season.totalEpisodes)].map((_, i) => {
                                    const ep = i + 1;
                                    const watched = isWatched(s.id, season.number, ep);
                                    return (
                                      <button
                                        key={ep}
                                        onClick={() => toggleWatched(s.id, season.number, ep)}
                                        className={`py-2 rounded-lg text-sm font-medium transition-colors ${
                                          watched
                                            ? 'bg-green-500 text-white'
                                            : 'bg-gray-100 text-gray-600 hover:bg-gray-200'
                                        }`}
                                      >
                                        {ep}
                                      </button>
                                    );
                                  })}
                                </div>
                              </div>
                            );
                          })}
                        </div>
                      )}
                    </div>
                  ))
                )}
              </div>
            );
          };

          const renderStats = () => {
            const weekly = getWeeklyStats();
            const monthly = getMonthlyStats();

            return (
              <div className="space-y-6">
                <div className="bg-gradient-to-br from-indigo-500 to-purple-600 rounded-lg shadow-lg p-6 text-white">
                  <h3 className="text-xl font-bold mb-4">ðŸ“Š Ä°statistikler</h3>
                  <div className="grid grid-cols-2 gap-4">
                    <div className="bg-white/20 rounded-lg p-4">
                      <div className="text-3xl font-bold">{series.length}</div>
                      <div className="text-sm opacity-90">Toplam Dizi</div>
                    </div>
                    <div className="bg-white/20 rounded-lg p-4">
                      <div className="text-3xl font-bold">{watchedEpisodes.length}</div>
                      <div className="text-sm opacity-90">Ä°zlenen BÃ¶lÃ¼m</div>
                    </div>
                  </div>
                </div>

                <div className="bg-white rounded-lg shadow-sm p-4">
                  <h4 className="font-bold text-lg mb-3 flex items-center gap-2 text-indigo-700">
                    <Calendar size={20} />
                    Son 7 GÃ¼n
                  </h4>
                  <div className="text-3xl font-bold text-gray-800 mb-3">{weekly.total} bÃ¶lÃ¼m</div>
                  {weekly.bySeries.length > 0 && (
                    <div className="space-y-2">
                      {weekly.bySeries.map((s, i) => (
                        <div key={i} className="flex items-center justify-between py-2 border-b border-gray-100 last:border-0">
                          <span className="text-gray-700">{s.name}</span>
                          <span className="font-semibold text-indigo-600">{s.count} bÃ¶lÃ¼m</span>
                        </div>
                      ))}
                    </div>
                  )}
                </div>

                <div className="bg-white rounded-lg shadow-sm p-4">
                  <h4 className="font-bold text-lg mb-3 flex items-center gap-2 text-indigo-700">
                    <BarChart3 size={20} />
                    Son 30 GÃ¼n
                  </h4>
                  <div className="text-3xl font-bold text-gray-800 mb-3">{monthly.total} bÃ¶lÃ¼m</div>
                  {monthly.bySeries.length > 0 && (
                    <div className="space-y-2">
                      {monthly.bySeries.map((s, i) => (
                        <div key={i} className="flex items-center justify-between py-2 border-b border-gray-100 last:border-0">
                          <span className="text-gray-700">{s.name}</span>
                          <span className="font-semibold text-indigo-600">{s.count} bÃ¶lÃ¼m</span>
                        </div>
                      ))}
                    </div>
                  )}
                </div>
              </div>
            );
          };

          const renderSeriesForm = (seriesObj, isEditing = false) => {
            const handleChange = (field, value) => {
              if (isEditing) {
                setEditingSeries({...seriesObj, [field]: value});
              } else {
                setNewSeries({...seriesObj, [field]: value});
              }
            };

            return (
              <div className="space-y-4">
                <input
                  type="text"
                  placeholder="Dizi AdÄ±"
                  value={seriesObj.name}
                  onChange={(e) => handleChange('name', e.target.value)}
                  className="w-full p-3 border border-gray-300 rounded-lg"
                />
                
                <div className="grid grid-cols-2 gap-3">
                  <select
                    value={seriesObj.day}
                    onChange={(e) => handleChange('day', e.target.value)}
                    className="w-full p-3 border border-gray-300 rounded-lg"
                  >
                    {DAYS.map(day => (
                      <option key={day} value={day}>{day}</option>
                    ))}
                  </select>
                  
                  <input
                    type="time"
                    value={seriesObj.time}
                    onChange={(e) => handleChange('time', e.target.value)}
                    className="w-full p-3 border border-gray-300 rounded-lg"
                  />
                </div>
                
                <input
                  type="text"
                  placeholder="Kanal (opsiyonel)"
                  value={seriesObj.channel}
                  onChange={(e) => handleChange('channel', e.target.value)}
                  className="w-full p-3 border border-gray-300 rounded-lg"
                />

                <div className="border-t pt-4">
                  <div className="flex items-center justify-between mb-3">
                    <h4 className="font-semibold text-gray-700">Sezonlar</h4>
                    <button
                      onClick={() => addSeason(seriesObj, isEditing)}
                      className="px-3 py-1 bg-indigo-100 text-indigo-700 rounded-lg text-sm font-medium hover:bg-indigo-200 transition-colors"
                    >
                      + Sezon Ekle
                    </button>
                  </div>
                  
                  <div className="space-y-3">
                    {(seriesObj.seasons || []).map((season, idx) => (
                      <div key={idx} className="flex items-center gap-3 p-3 bg-gray-50 rounded-lg">
                        <div className="font-medium text-gray-700 w-20">Sezon {season.number}</div>
                        <input
                          type="number"
                          min="1"
                          value={season.totalEpisodes}
                          onChange={(e) => updateSeasonEpisodes(seriesObj, idx, e.target.value, isEditing)}
                          className="flex-1 p-2 border border-gray-300 rounded-lg"
                          placeholder="BÃ¶lÃ¼m sayÄ±sÄ±"
                        />
                        <button
                          onClick={() => removeSeason(seriesObj, idx, isEditing)}
                          className="p-2 text-red-500 hover:bg-red-50 rounded-lg transition-colors"
                          disabled={seriesObj.seasons && seriesObj.seasons.length <= 1}
                        >
                          <Trash2 size={18} />
                        </button>
                      </div>
                    ))}
                  </div>
                </div>
              </div>
            );
          };

          if (loading) {
            return (
              <div className="loading">
                <div className="text-center">
                  <div className="text-4xl mb-4">ðŸ“º</div>
                  <div className="text-xl font-semibold text-gray-700">YÃ¼kleniyor...</div>
                </div>
              </div>
            );
          }

          return (
            <div className="min-h-screen bg-gradient-to-br from-indigo-50 to-purple-50">
              <div className="max-w-2xl mx-auto p-4 pb-24">
                <div className="text-center mb-6 pt-4">
                  <h1 className="text-3xl font-bold text-gray-800 mb-2">ðŸ“º Dizi Takip</h1>
                  <p className="text-gray-600">Dizilerinizi kolayca takip edin</p>
                  <p className="text-xs text-gray-400 mt-1">Cihaz ID: {deviceId.substr(0, 15)}...</p>
                </div>

                <div className="flex gap-2 mb-6 bg-white rounded-lg p-1 shadow-sm">
                  <button
                    onClick={() => setActiveTab('program')}
                    className={`flex-1 py-2 px-4 rounded-lg font-medium transition-colors ${
                      activeTab === 'program'
                        ? 'bg-indigo-500 text-white'
                        : 'text-gray-600 hover:bg-gray-100'
                    }`}
                  >
                    HaftalÄ±k Program
                  </button>
                  <button
                    onClick={() => setActiveTab('series')}
                    className={`flex-1 py-2 px-4 rounded-lg font-medium transition-colors ${
                      activeTab === 'series'
                        ? 'bg-indigo-500 text-white'
                        : 'text-gray-600 hover:bg-gray-100'
                    }`}
                  >
                    Dizilerim
                  </button>
                  <button
                    onClick={() => setActiveTab('stats')}
                    className={`flex-1 py-2 px-4 rounded-lg font-medium transition-colors ${
                      activeTab === 'stats'
                        ? 'bg-indigo-500 text-white'
                        : 'text-gray-600 hover:bg-gray-100'
                    }`}
                  >
                    Raporlar
                  </button>
                </div>

                {activeTab === 'program' && renderProgram()}
                {activeTab === 'series' && renderSeries()}
                {activeTab === 'stats' && renderStats()}

                {showAddForm && (
                  <div className="fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50 overflow-y-auto">
                    <div className="bg-white rounded-lg p-6 w-full max-w-md my-8">
                      <h3 className="text-xl font-bold mb-4">Yeni Dizi Ekle</h3>
                      
                      {renderSeriesForm(newSeries, false)}
                      
                      <div className="flex gap-3 mt-6">
                        <button
                          onClick={addSeries}
                          className="flex-1 bg-indigo-500 text-white py-3 rounded-lg font-medium hover:bg-indigo-600 transition-colors"
                        >
                          Ekle
                        </button>
                        <button
                          onClick={() => {
                            setShowAddForm(false);
                            setNewSeries({
                              name: '',
                              day: 'Pazartesi',
                              time: '20:00',
                              channel: '',
                              seasons: [{ number: 1, totalEpisodes: 10 }]
                            });
                          }}
                          className="flex-1 bg-gray-200 text-gray-700 py-3 rounded-lg font-medium hover:bg-gray-300 transition-colors"
                        >
                          Ä°ptal
                        </button>
                      </div>
                    </div>
                  </div>
                )}

                {editingSeries && (
                  <div className="fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50 overflow-y-auto">
                    <div className="bg-white rounded-lg p-6 w-full max-w-md my-8">
                      <h3 className="text-xl font-bold mb-4">Dizi DÃ¼zenle</h3>
                      
                      {renderSeriesForm(editingSeries, true)}
                      
                      <div className="flex gap-3 mt-6">
                        <button
                          onClick={updateSeries}
                          className="flex-1 bg-indigo-500 text-white py-3 rounded-lg font-medium hover:bg-indigo-600 transition-colors"
                        >
                          GÃ¼ncelle
                        </button>
                        <button
                          onClick={() => setEditingSeries(null)}
                          className="flex-1 bg-gray-200 text-gray-700 py-3 rounded-lg font-medium hover:bg-gray-300 transition-colors"
                        >
                          Ä°ptal
                        </button>
                      </div>
                    </div>
                  </div>
                )}

                <button
                  onClick={() => setShowAddForm(true)}
                  className="fixed bottom-6 right-6 bg-indigo-500 text-white p-4 rounded-full shadow-lg hover:bg-indigo-600 transition-colors z-40"
                >
                  <Plus size={24} />
                </button>
              </div>
            </div>
          );
        }

        ReactDOM.render(<TVSeriesTracker />, document.getElementById('root'));
    </script>
</body>
</html>
